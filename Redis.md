# Redis

https://redis.io/commands

##### Для PHP можно использовать phpredis – это бинарное расширение
```php
$redis = new Redis();
$redis->connect('127.0.0.1', 6379);
```
#### По умолчанию порт сервиса `6379`

##### Командный интерфейс:
```
redis-cli
```

##### Самая простая операция – это установка строкового значения по ключу и чтение:
```bash
127.0.0.1:6379> EXISTS foo
(integer) 0
127.0.0.1:6379> SET foo "Hello!" OK
127.0.0.1:6379> GET foo "Hello!"
127.0.0.1:6379> EXISTS foo
(integer) 1
```

##### Установка строкового значения по ключу с установкой срока жизни значения в секундах или миллисекундах  `EX - expires (секунды) PX - миллисекунды`: 
```bash
127.0.0.1:6379> SET foo "Hello!" EX 5
OK
127.0.0.1:6379> GET foo "Hello!"
127.0.0.1:6379> GET foo
(nil)
```

##### Установка нового значения с возвращением старого:
```bash
127.0.0.1:6379> SET foo "Hello!"
OK
127.0.0.1:6379> GETSET foo "World"
"Hello!"
127.0.0.1:6379> GET foo
"World"
```

##### Добавление к значению строки:
```bash
127.0.0.1:6379> SET foo "Hello"
OK
127.0.0.1:6379> APPEND foo " World"
(integer) 11
127.0.0.1:6379> GET foo
"Hello World"
```

##### Инкремент и декремент (счетчики:

```bash
127.0.0.1:6379> SET foo 1
OK
127.0.0.1:6379> INCR foo
(integer) 2
127.0.0.1:6379> GET foo
"2"
127.0.0.1:6379> DECR foo
(integer) 1
127.0.0.1:6379> GET foo
"1"
```


##### «Хэш-таблицы»

• Хэш-таблицу можно представлять себе как
объект, состоящий из полей. Каждое поле
имеет своё имя и значение.

• Другое название – «ассоциативный массив»

```bash
127.0.0.1:6379> HSET obj foo 42
(integer) 1
127.0.0.1:6379> HGET obj foo
"42"
127.0.0.1:6379> HSET obj bar 24
(integer) 1
127.0.0.1:6379> HGETALL obj
1) "foo"
2) "42"
3) "bar"
4) "24"
127.0.0.1:6379> HVALS obj
1) "42"
2) "24"
```

##### «Множество»

• Множество – это неупорядоченный набор
значений.
```bash
127.0.0.1:6379> SADD myset "Hello"
(integer) 1
127.0.0.1:6379> SADD myset "World"
(integer) 1
127.0.0.1:6379> SMEMBERS myset
1) "World"
2) "Hello"
127.0.0.1:6379> SCARD myset
(integer) 2
```
####### SISMEMBER, SUNION, SDIFF, SINTER,SREM, SPOP, SMOVE

##### «Списки»

• Список – это последовательность значений,
упорядоченных по порядку их создания.
```bash
127.0.0.1:6379> LPUSH mylist "first"
(integer) 1
127.0.0.1:6379> LPUSH mylist "second"
(integer) 2
127.0.0.1:6379> LPOP mylist
"second”
127.0.0.1:6379>
LINSERT mylist BEFORE first "zero"
(integer) 2
127.0.0.1:6379> LRANGE mylist 0 -1
1) "zero"
2) "first"
```

##### «Упорядоченные множества»
А еще есть упорядоченные множества. Это как
множество, но вы можете задать порядок J
```bash
127.0.0.1:6379> ZADD myzset 2 "one"
(integer) 1
127.0.0.1:6379> ZADD myzset 1 "two"
(integer) 1
127.0.0.1:6379>
ZRANGE myzset 0 -1 WITHSCORES
1) "two"
2) "1"
3) "one"
4) "2"
```

##### «Транзакции»

Транзакция: множество команд,
выполняющихся, как одна команда.
```bash
127.0.0.1:6379> MULTI
OK
127.0.0.1:6379> INCR foo
QUEUED
127.0.0.1:6379> INCR bar
QUEUED
127.0.0.1:6379> EXEC
1) (integer) 3
2) (integer) 1
```
Команда `DISCARD` прерывает набор команд в
транзакцию.
N. B. Важно понимать, что в Redis нет отката!
Сбой одной из команд в «транзакции» не
приводит к отмене предыдущих, вместо этого
выполняются все следующие L

##### «Подписки»

Механизм подписок в Redis устроен очень
просто.
• Одни клиенты сервиса Redis подписываются
на определенные каналы сообщений:
```bash
127.0.0.1:6379> SUBSCRIBE channel1
Reading messages... (press Ctrl-C to
quit)
1) "subscribe"
2) "channel1"
3) (integer) 1
```
• Другие клиенты могут посылать сообщения в
каналы. Подписанные на данные каналы
клиенты получат сообщения:
```bash
127.0.0.1:6379>
PUBLISH channel1 "Hello!"
(integer) 1
...
3) "Hello!"
```

##### Практика применения

Redis достаточно широко применяется в
современной разработке ПО.
Поддерживаемые языки программирования
включают Java, Python, PHP, C, C++, C#, JavaScript,
Node.js, Ruby, R, Go и многие другие.
Асинхронная репликация позволяет почти
неограниченно масштабировать Redis.
• PHP может хранить данные сессий в Redis. Это
дает нам увеличение производительности и
отсутствие блокировок.
• Кэширование данных.
• Чаты и системы обмена сообщениями.
• Различные очереди задач
• Мгновенно сортируемые «таблицы лидеров»
